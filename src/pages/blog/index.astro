---
import AstroshipLayout from '../../layouts/AstroshipLayout.astro';
import Container from '../../components/container.astro';
import { getCollection } from 'astro:content';

// Get all blog posts and sort by publish date (newest first)
const allPosts = await getCollection('blog');
const sortedPosts = allPosts.sort((a, b) =>
  new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
);
---

<AstroshipLayout
  title="Blog - Shout.com"
  description="Keep up to date with the Shout blog to learn about how you can use feedback to transform your business."
>
  <!-- Hero Section -->
  <section class="py-20">
    <Container>
      <div class="text-center max-w-3xl mx-auto">
        <h1 class="text-5xl lg:text-6xl font-bold lg:tracking-tight mb-6">
          Latest News
        </h1>
        <p class="text-lg text-gray-600">
          Keep up to date with the Shout blog to learn about how you can use feedback to transform your business.
        </p>
      </div>
    </Container>
  </section>

  <!-- Featured Post -->
  {sortedPosts.length > 0 && (
    <section class="py-16 bg-gray-50">
      <Container>
        <article class="bg-white rounded-lg border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow">
          <div class="grid lg:grid-cols-2 gap-0">
            {sortedPosts[0].data.image && (
              <div class="aspect-video lg:aspect-auto overflow-hidden">
                <img
                  src={sortedPosts[0].data.image.src}
                  alt={sortedPosts[0].data.image.alt}
                  class="w-full h-full object-cover"
                  loading="eager"
                />
              </div>
            )}
            <div class="p-8 lg:p-12 flex flex-col justify-center">
              {sortedPosts[0].data.category && (
                <span class="inline-block bg-primary text-white text-xs font-semibold px-3 py-1 rounded-full uppercase tracking-wide mb-4 w-fit">
                  {sortedPosts[0].data.category}
                </span>
              )}
              <h2 class="text-2xl lg:text-3xl font-bold mb-4">
                <a href={`/blog/${sortedPosts[0].slug}/`} class="text-gray-900 hover:text-primary transition-colors">
                  {sortedPosts[0].data.title}
                </a>
              </h2>
              <p class="text-gray-600 text-lg mb-6 line-clamp-3">{sortedPosts[0].data.description}</p>
              <div class="flex flex-wrap gap-4 text-sm text-gray-500">
                {sortedPosts[0].data.author && (
                  <span class="font-medium">By {sortedPosts[0].data.author}</span>
                )}
                <time datetime={sortedPosts[0].data.publishDate.toISOString()}>
                  {sortedPosts[0].data.publishDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  })}
                </time>
                {sortedPosts[0].data.readingTime && (
                  <span>{sortedPosts[0].data.readingTime}</span>
                )}
              </div>
            </div>
          </div>
        </article>
      </Container>
    </section>
  )}

  <!-- All Posts Grid -->
  {sortedPosts.length > 1 && (
    <section class="py-16">
      <Container>
        <h2 class="text-4xl lg:text-5xl font-bold lg:tracking-tight mb-12">All Articles</h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          {sortedPosts.slice(1).map((post) => (
            <article class="bg-white rounded-lg border border-gray-200 overflow-hidden hover:shadow-md transition-shadow">
              {post.data.image && (
                <a href={`/blog/${post.slug}/`} class="block aspect-video overflow-hidden">
                  <img
                    src={post.data.image.src}
                    alt={post.data.image.alt}
                    class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                    loading="lazy"
                  />
                </a>
              )}
              <div class="p-6">
                {post.data.category && (
                  <span class="inline-block bg-primary text-white text-xs font-semibold px-2 py-0.5 rounded-full uppercase tracking-wide mb-3">
                    {post.data.category}
                  </span>
                )}
                <h3 class="text-xl font-semibold mb-2">
                  <a href={`/blog/${post.slug}/`} class="text-gray-900 hover:text-primary transition-colors">
                    {post.data.title}
                  </a>
                </h3>
                <p class="text-gray-600 text-sm mb-4 line-clamp-2">{post.data.description}</p>
                <div class="flex flex-wrap gap-3 text-xs text-gray-500">
                  {post.data.author && (
                    <span class="font-medium">By {post.data.author}</span>
                  )}
                  <time datetime={post.data.publishDate.toISOString()}>
                    {post.data.publishDate.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'short',
                      day: 'numeric'
                    })}
                  </time>
                </div>
              </div>
            </article>
          ))}
        </div>
      </Container>
    </section>
  )}

  <!-- No Posts Message -->
  {sortedPosts.length === 0 && (
    <section class="py-16">
      <Container>
        <div class="text-center py-16">
          <p class="text-gray-600 text-lg">No blog posts yet. Check back soon!</p>
        </div>
      </Container>
    </section>
  )}

  <!-- CTA Section -->
  <section class="py-16 bg-gray-50">
    <Container>
      <div class="text-center max-w-3xl mx-auto">
        <h2 class="text-4xl lg:text-5xl font-bold lg:tracking-tight mb-6">
          Ready to transform your feedback?
        </h2>
        <p class="text-lg text-gray-600 mb-8">
          Start collecting actionable insights with Shout's powerful survey tools.
        </p>
        <a href="https://identity.shout.com/Account/Login" class="inline-block bg-black text-white px-6 py-3 rounded-md font-semibold hover:bg-gray-800 transition-colors">
          Start Your Free Trial
        </a>
      </div>
    </Container>
  </section>
</AstroshipLayout>
